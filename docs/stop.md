# Stop 命令

优雅地停止进程是FuckRun的重要特性之一。Stop命令不仅仅是简单地终止进程，而是通过一系列精心设计的步骤，确保进程能够安全、干净地退出。

## 命令格式

```bash
fuckrun stop [选项]
```

## 核心参数

### 进程名称 (-n, --name)

指定要停止的进程名称。这个名称必须是之前通过start命令启动的进程：

```bash
fuckrun stop -n web
```

## 停止流程

当执行stop命令时，FuckRun会按照以下流程处理：

1. 状态检查
   - 验证进程是否存在
   - 检查进程状态文件
   - 确认进程仍在运行

2. 优雅关闭
   - 发送SIGTERM信号
   - 等待进程自行退出
   - 处理子进程

3. 强制终止
   - 如果进程未能及时退出
   - 发送SIGKILL信号
   - 确保进程完全终止

4. 清理工作
   - 更新状态文件
   - 关闭日志文件
   - 释放资源

## 平台特性

### Windows平台

在Windows平台上，Stop命令会：
- 首先终止monitor进程
- 然后终止目标进程
- 清理进程组
- 处理孤立进程

### Unix/Linux平台

在Unix/Linux平台上，Stop命令会：
- 发送标准Unix信号
- 处理进程组
- 清理会话
- 重置文件描述符

## 使用场景

### Web服务停止

停止一个Web服务：

```bash
fuckrun stop -n web
```

### 批量停止

通过脚本批量停止多个相关进程：

```bash
for service in web api worker; do
    fuckrun stop -n $service
done
```

### 开发调试

快速停止开发服务：

```bash
fuckrun stop -n dev
```

## 最佳实践

1. 给予足够的优雅关闭时间
2. 在停止前保存重要数据
3. 确保所有子进程都被正确终止
4. 检查日志确认停止状态
5. 定期清理过期的状态文件

## 常见问题

### 进程无法停止

可能的原因：
- 进程处于D状态（不可中断）
- 子进程未正确终止
- 进程被其他程序锁定
- 文件系统问题

解决方案：
1. 检查进程状态（ps/top）
2. 查看系统日志
3. 使用更强制的终止方式
4. 重启系统服务

### 状态不同步

可能的原因：
- 进程异常退出
- 状态文件损坏
- 手动终止进程
- 系统崩溃

解决方案：
1. 手动清理状态文件
2. 重新启动进程
3. 检查系统日志
4. 修复工作目录权限

## 注意事项

1. 数据安全
   - 在停止前确保数据已保存
   - 等待写操作完成
   - 关闭数据库连接

2. 资源释放
   - 释放文件句柄
   - 关闭网络连接
   - 清理临时文件

3. 依赖处理
   - 考虑进程间的依赖关系
   - 按正确顺序停止服务
   - 等待依赖服务完全停止

4. 状态维护
   - 更新状态文件
   - 记录停止原因
   - 保存必要的调试信息 